- 域相关的AD组件
- 域名解析相关的DNS组件
- 网络相关的DNS组件
```txt
         |负载均衡＆　接入控制　    |　桌面会话管理　　　       |云资源管理及调度
管理员    |
         |                      | ITA      License/TCM   |Fusion Manager
云终端TC  |     负载均衡&接入模块   |        HDC             |FusionCompute
         |                      | Web Interface  GaussDB |FusinStorage

                      基础服务　　AD  DNS DHCP
```

接入和访问控制层　　WI(Web Interface) Web 接口　WI为最终用户提供Web登录界面
---

用户发起登录请求时，将用户登录信息(加密后的用户名和密码)转发到AD上进行用户身份验证；用户身份验证通过后，WI将HDC提供的虚拟机列表呈现给用户，为用户访问虚拟机提供入口

接入和访问控制层  vAG(Virtual Access Gateway)虚拟接入网关

TC --->HDP桌面协议---> vAG ---> 自助维护台，HDP桌面协议--->远程桌面

vAG的主要功能是桌面接入网关和自助维护台网关。当用户虚拟机出现故障时，用户无法通过远程协议登录虚拟机时，需要通过VNC自助维护登录虚拟机进行维护

接入访问控制层　vLB(Virtual Load Balance)虚拟负载均衡器
---

TC --->vLB --->WI

vAG作为接入网关，用于桌面协议HDP的接入和自助维护接入；vLB则用于多个WI负载均衡

虚拟桌面管理层　ITA (IT Adaptor) IT适配器
---

ITA为用户管理虚拟机提供接口，ITA Portal 。其通过与HDC(Huawei Desktop Controller)的交互。以及与云平台软件FusionCompute的交互，实现虚拟机的创建、分配、虚拟机状态管理、虚拟机镜像管理、虚拟机系统操作维护

虚拟桌面管理层　HDC (Huawei Desktop Controller)华为桌面控制器

单套HDC桌面控制器可以管理5000桌面；一套ITA支持多套HDC的方式，最大可以管理20000桌面

HDC是虚拟桌面管理软件的核心组件，根据ITA发送请求进行桌面组的管理、用户和虚拟桌面关联管理、虚拟机登录的相关处理等

虚拟桌面管理层　License服务器
---

两种授权方式　1. 最大用户数授权　2.　最大并发用户数授权

三种许可类型　桌面云高级版许可、桌面云标准版许可、应用虚拟化标准版许可

License服务器是License的管理与发放系统；负责HDC的License管理和发放

对于混合模式的License 要求不同类型的用户分别部署１套HDC来控制，每套HDC需要指定类型是用户数还是并发数

虚拟桌面管理层　GaussDB数据库
---

GaussDB为ITA 、HDC提供数据库，用于存储数据信息

Back Server备份服务器:主要备份各个组件关键文件和数据，每天01:00自动通过ftps将FusionAccess各组件上的备份文件上传到Back Server备份服务器

Backup Server服务器最多保存最近10天的备份文件　/var/ftpsite/配套的ITA组件名称/各组件文件夹名称

FusionAccess管理组件统一基于Linux部署

|VM1|VM2|VM3|VM4|VM5|
|:---|:---|:---|:---|:---|
|ITA主|ITA备|vLB主|vLB备|Backup Server|
|WI|WI|vAG|vAG||
|HDC|HDC||||
|DB主|DB备||||
|Lic|||||

桌面云关联组件AD DNS DHCP

AD 活动目录是用来存储网络上用户账户、计算机、打印机等资源信息;是一种目录服务，可以提供对象的存储、快速查找定位，而且能够统一、集中、安全的管理计算机资源。

在windows AD域内的目录是用来存储用户账户、组、打印机、共享文件夹等对象、

AD域的作用:　管理和保护桌面系统的用户账户、批量下发域策略等

AD对象Object
---

活动目录的最小单元为对象(Object)，也是一组属性的集合，一个AD网域中，以树状结构，组织如下对象:
- 域控　(Domain Controllers) 存储网域所属的网域控制站，简称域控
- 计算机(Computers) 存储加入网域的电脑对象
- 系统默认账户组群(Builtin) 存储自带的账户组群
- 用户(Users) 存储AD中的用户对象
- 组织单元(Oranization Unit,OU) 可以在OU中放AD的对象，包括用户、组群、电脑等，让组织结构在AD中可以被真实的反映出来，便于以组织结构方式管理对象

域控制器Domain Controller
---

AD域服务的目录数据存储在域控制器DC内，一个域内可以有多个域控制器，每个域控制器的地位(几乎)是平等的，由于域控制器间存在着数据同步，他们各自存储着一份(几乎)完全相同的AD数据库。

搭建FusionAccess桌面时可以新安装域控制器来建立新域提供域服务，也可以对接现有域控

域策略、组策略
---

- 管理员可以很方便管理域中的计算机和用户的工作环境(用户桌面、计算机启动或关机、用户登录或注销、软件安装、安全设置等);推行公司使用计算机规范，包括桌面环境规范和安全策略等

> 组策略是一种单到多的管理模式，可以强制性对网络中的客户端进行安全配置；灵活的对网络中客户端进行软件部署；强化企业软件管理(如限制某些软件不能在企业中使用)；将复杂的系统设置简单化。

> 组策略还可以做到站点、域级别的集中化管理，组织单位级别分散式管理；控制用户调度软件环境；通过控制用户和计算机环境，降低企业管理成本

- 组策略: 计算机配置和用户配置

> 组策略通过组策略对象(GPO)来设置，只要将GPO链接到指定的站点、域或组织单位，此GPO内的设置就会影响到该站点。域或组织单位内所有用户与计算机

> AD 域两个默认内置GPO  Default Domain Policy; Default Domain Controller Policy

- 计算机配置:当计算机开机时，系统会根据计算机配置的属性开设置计算机环境。
- 用户配置: 当用户登录时，系统会根据用户配置的属性来配置用户的工作环境。例如: 如果对组织单位UserOU配置了组策略，此组策略配置就会被应用到这个组织单位内的所有用户

> Default Domain Policy 此GPO默认已经被链接到域，因此其设置值会被应用到整个域内所有用户与计算机．例如:默认只有加入到本地管理员组中的用户(组),才可以登录虚拟机，在制作模板的时候，可以勾选"配置用户登录"，则表明虚拟机允许Users组成员(含域用户)登录。用户需要配置AD服务器Default Domain Policy中“允许本地登录”策略才能使登录策略生效。

> Default Domain Controller Policy 此GPO默认已经被链接到组织单位Domain Controller 因此其设置会被应用到组织单位Domain Controller内所有用户与计算机

域策略

举例:修改域内DNS客户端首选DNS和备选DNS记录

创建组策略将更改DNS设置的脚本发布到"计算机配置"中 --->打开Active Directory用户和计算机--->点击相应的OU，选择属性－组策略--->创建一条新的组策略，进行编辑。--->展开"计算机配置"--->"安全配置"--->"启动脚本"--->在启动脚本中将vbs文件添加到此脚本中即可

AD组策略应用

强化企业中软件管理；将复杂的系统设置简单化。　强制性安全配置

用户域帐号

域用户帐号是在域控上建立的，是访问域的唯一凭证，作为AD的一个对象Object保存在AD域的数据库中。用户从域中任何计算机登录必须提供合法域用户帐号，该帐号被域控制器验证

域帐号常用操作　添加到组、禁用、移动、删除、重设密码、重命名

用户组: 组是用户帐号的逻辑组合；将用户分组管理，方便管理域内资源的访问权限

用户组用来简化资源权限分配；一个用户可以同时属于多个组；组可以嵌套到其它组中

组织单元OU
---

- OU可以把对象组织到一个逻辑结构中，使其能最佳适应组织的需要；委派OU的管理控制权，必须把OU及OU包含对象的具体的权限指定给一个或几个用户和组

用户组和OU关系

> 相同点: OU和用户组都是活动目录对象

> 不同点: 用户组中包含的对象类型有限，只能是帐号；OU中可以包含帐号、计算机、打印机、共享文件夹；OU还有组策略功能

域和OU的关系

> 相同点: OU和域都属于活动目录的逻辑结构范畴；OU和域都是用户和计算机的管理单元，都可以容纳AD的对象，都可以设置组策略

> 不同点: 用户只能登录到域。而不能登录到OU;先有域，后有OU；OU只能存在于域中，反之不可；域级别比OU高

AD典型应用模型

所有用户在单个域内

```txt
             Central IT
             corp.example.com
 OU=div1          OU=div2        OU=div3
 Division 1       Division 2     Division 3
```
适用于小公司；所有用户、设备都在一个域内；单一域，部署方便，集中管理维护方便；不同部门之间可以设置不同的OU来对不同用户和设备、进行分离管理。


AD典型桌面应用模型

用户按域中用户名来登录桌面--->HDC向AD进行用户信息认证--->用户虚拟机向域控同步域信息

```txt
      IT部件　DNS  DHCP   AD
                          |\ 登录认证
                          | \
                          |  \
                          |   \ 域信息同步
TC ---> LB/AG --->WI --->HDC--->VDA APP 操作系统
                          |
        (License Server)  LS

终端　　　　　FusionAccess         FusionSphere
```
用户虚拟机从域控同步信息，可以在用户登录时信息同步，或者通过AD强制同步

DNS
---

域名系统(Domain Name System,DNS),是一种提供域名和IP地址之间的转换的分布式数据库

DNS的优势　域控会通过将它的主机名、IP地址和角色等信息注册到DNS服务器内，以便其它计算机通过DNS服务器找到域控

DNS的查询方式有递归查询和迭代查询两种

递归查询：DNS服务器收到客户机请求，必须用一个准确查询结果回复客户机。如果本地DNS服务器里没有，该服务器会询问其它DNS服务器，并返回结果给客户机
```txt        
递归
１－－>2--->3(有这条记录)
1<--- 2<---

迭代
1 --->2没有，介绍３
1---->3没有，介绍４
1--->4有这条记录，４返回给１，不经过２，３
```

迭代查询:DNS服务器会向客户机提供其它能够解析查询请求的DNS服务器地址，当客户机发送请求时，DNS服务器并不直接回复查询结果，而是告诉另外一台DNS服务器的地址，客户再向这台DNS服务器提交请求，依次循环直到返回查询结果

https://blog.csdn.net/wyq_tc25/article/details/51679520

正向解析(将域名解析成IP)－逆向解析(由IP解析成域名)

反向查找区域创建后，还要为该域创建记录指针。在创建正向查找区域主机(A)记录时，勾选“创建相关指针”则会自动在反向区域内自动添加相应指针

DHCP  (Dynamic Host Configuration Protocol) 是一种动态的向Internet终端提供配置参数的协议。在终端提出申请之后，DHCP可以向终端提供IP地址、网关、DNS服务器地址等参数

```txt
          提出申请
client ------------------- DHCP Server (IP地址池)
　　　　　　分配地址等参数
```

