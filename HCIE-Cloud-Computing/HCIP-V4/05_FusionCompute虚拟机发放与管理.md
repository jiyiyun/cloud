1. 计算资源管理
2. 存储资源管理
3. 网络资源管理
4. 虚拟机发放
5. 虚拟机管理

FusionCompute资源主要包括主机和集群资源、网络资源和存储资源。

FusionCompute将主机的物理CPU、内存资源整合为计算资源池，然后划分出虚拟的CPU和内存资源为虚拟机提供计算能力

集群管理

|功能|说明|界面入口|
|:---|:---|:---|
|监控集群|查看集群监控信息，了解集群在指定时间段运行情况||
|配置集群属性|调整集群属性，包括HA策略、内存复用策略、虚拟机启动策略等||
|配置资源调度策略|设置集群的计算资源调度策略，实现集群内计算资源的动态调度，达到计算资源合理分配|首页-->资源池--->集群|

集群基本配置
1. 主机内存复用　内存气泡　内存共享　　内存置换
2. 虚拟机启动策略　自动分配　　负载均衡
3. 虚拟机NUMA结构自动调整

主机管理

|功能|说明|界面入口|
|:---|:---|:---|
|监控主机|查看主机监控信息，了解主机在指定时间运行状态|首页--->资源池--->主机|
|配置主机属性|调整主机属性，包括时间同步策略、BMC设置、存储多路径类型、维护模式等||
|配置主机网口|管理与维护主机的网口，包括绑定网口、关联存储接口等|首页--->资源池--->主机--->配置|
|配置主机关联的存储资源|为主机关联存储资源，以便为主机上的虚拟机提供存储空间||

存储资源介绍

FusionCompute可以使用存储资源来自本地磁盘或专用的存储设备。

FusionCompute支持的存储类型及各存储形态

|存储设备|存储资源|数据存储|数据存储对存储空间的要求|
|本地硬盘||虚拟化本地硬盘(虚拟化)|2GB,16TB|
|SAN存储|SAN存储|虚拟化SAN存储(虚拟化)，裸设备共享存储(裸设备映射)|5GB,64TB|
|NAS存储|NAS存储|NAS存储||
|FusionStorage Block|FusionStorage Block|FusionStorage Block||

存储资源配置过程IP-SAN

开始--->为主机添加心跳平面业务管理接口(虚拟化SAN存储)--->添加存储接口--->向站点添加存储资源--->关联存储资源到主机--->配置存储空间映射--->扫描存储设备--->添加数据存储--->创建磁盘

FusionCompute数据存储使用方式
1. 虚拟化的数据存储创建普通磁盘比较慢，但可支持部分高级特性，如创建精简磁盘；格式化　存储设备在初次使用时，请确认存储设备上的数据以不再使用。
2. 非虚拟化存储　当存储资源为FusionStorage时，创建数据存储默认为非虚拟化
3. 裸设备映射　将SAN存储的物理LUN直接作为磁盘绑定给业务虚拟机，使SAN存储具有更高的性能。

裸设备映射的数据存储只能整块当做裸设备映射的磁盘使用，不可分割，创建与数据存储同等容量的磁盘，不支持虚拟化存储的高级功能。

FusionCompute磁盘参数
1. 磁盘类型
- 普通　普通磁盘只能给单个虚拟机使用
- 共享　共享磁盘可以绑定多个虚拟机
2. 配置模式
- 普通　根据磁盘容量为磁盘分配空间，在创建过程会将物理设备上保留的数据置零
- 精简　首次仅分配磁盘容量配置值的部分容量，后续根据使用情况，逐步分配，直到达到磁盘容量配置值为止
- 普通延迟置零　根据磁盘容量为磁盘分配空间，创建时占用极少空间做标记，初次使用分配所有空间
3. 磁盘模式
-　从属　快照中包含该从属磁盘，更改将立即并永久写入磁盘
-　独立－持久　更改将立即永久写入磁盘，持久磁盘不受快照影响
-　独立－非持久　关闭电源或者恢复快照后，丢弃对该磁盘的更改

若选择“独立－持久”或“独立－非持久”，则虚拟机创建快照时，不对磁盘的数据进行快照。使用快照还原虚拟机时，不对该磁盘的数据进行还原。
- 如果快照后，该磁盘被绑定且未绑定其它虚拟机，则快照恢复的虚拟机会重新绑定该磁盘，但磁盘数据不进行还原
- 如果快照后，该磁盘被删除，则快照恢复的虚拟机上不存在该磁盘

限制条件
- 当数据存储类型为"虚拟化SAN存储"且磁盘类型为“共享”时，该磁盘不支持创建快照，默认“独立-持久”
- 当磁盘为“普通”时，磁盘才可以创建为“独立－非持久”模式

网络资源管理

|网络元素|说明|
|:---|:---|
|分布式交换机|分布式交换机是一个虚拟交换机，功能类似于二层物理交换机，通过端口组与虚拟机连接，通过上行链路与物理网络连接|
|端口组|端口组是虚拟的逻辑端口，类似于网络属性模板，用于定义虚拟虚拟机网卡属性通过分布式交换机连接到网络的方式。VLAN方式　使用该端口组的虚拟机网卡不会被分配IP地址(需要用户向虚拟机该网卡配置IP地址，但虚拟机会连接到端口组定义的VLAN)|
|上行链路|上行链路是分布式交换机连接主机物理网卡的链路，用于虚拟机数据上行|

FusionCompute分布式虚拟交换机类型

|普通模式|SR-IOV模式|用户态交换模式|
|:---|:---|:---|
|上行链路所关联的主机物理网卡为普通网卡|上行链路使用的是SR-IOV直通网卡时选择此模式|上行链路使用网口使用的驱动模式必须为用户态驱动模式|

- 在选择SR-IOV直通模式的分布式交换机里创建的端口组，端口类型只能使用“普通”
- 如果虚拟机使用了SR-IOV直通网卡，则不能使用休眠、唤醒、在线迁移、整机迁移、内存快照、内存热添加、网卡在线添加与删除、IP MAC绑定
- 当要配置DPDK驱动类型的网口绑定模式或使用用户态交换模式的分布式交换机时，必须先将网口的驱动模式设置为用户态驱动模式

端口组管理

- 端口类型　普通　普通类型的虚拟端口只能属于一个VLAN，中继类型的虚端口可以允许多个VLAN接收和发送报文。普通虚拟机选择普通类型的端口，虚拟机网卡启用VLAN设备情况下选择中继类型的端口，否则虚拟机的网络可能不通；　中继：端口组配置为中继的方式后，可以在linux虚拟机内创建多个VLAN设备，这些VLAN设备通过1个虚拟网卡即可收发多个携带不同VLAN标签的网络数据包。使虚拟机不用创建多个虚拟网卡，即可收发携带不同VLAN标签的网络数据包。
- 广播抑制　抑制广播报文带宽，可以限制虚拟机发送大量广播报文，防止广播报文攻击
- DHCP隔离　使用该端口组的虚拟机无法启动DHCP Server服务，以防止用户无意识或恶意启动DHCP Server服务，影响启动虚拟机IP地址正常分配
- IP与MAC绑定　仅当选择“端口组类型”为“普通”，且虚拟机为通过自定义虚拟机方式设置的IP时有效。使用该端口组的虚拟机，IP和MAC绑定，防止仿冒，开启该功能，如果虚拟机网卡配置多个IP则导致网卡部分IP地址通信异常，建议在开启多个IP时不开启此功能
- 填充TCP校验和　该端口组下虚拟机在接收报文时，系统会自动填充TCP校验和。此开关之应用于对TCP校验和正确性有要求的场景，不建议开启，开启后虚拟机网络收包性能会有所下降

安全组管理

- 位于同一个安全组的所有虚拟机网卡将使用该安全组规则进行通信，虚拟机一块网卡只能加入一个安全组中
- 管理员通过FusionCompute为安全组添加规则，位于同一个安全组的所有虚拟机网卡都将使用该安全组规则进行网络通信

使用模板创建虚拟机

|创建方式|说明|
|:---|:---|
|将模板转换为虚拟机|创建后虚拟机所有属性和模板相同，模板将不存在|
|按模板部署虚拟机|部署虚拟机前准备好ova模板或ovf模板，ovf模板包含ovf文件和vhd两个文件；以下属性继承自模板，其它属性可自定义(虚拟机操作系统类型和操作系统版本号；虚拟机磁盘数量、容量、和总线类型；虚拟机网卡数)|
|使用模板导入虚拟机|导入虚拟机前准备好ova模板或ovf模板，ovf模板包含ovf文件和vhd两个文件；以下属性继承自模板，其它属性可自定义(虚拟机操作系统类型和操作系统版本号；虚拟机磁盘数量、容量、和总线类型；虚拟机网卡数)|

使用已有虚拟机创建新虚拟机

基于已有虚拟机创建的虚拟机，在创建时可以调整部分虚拟机参数

FusionCompute创建虚拟机的5种方法　
1. 手动创建虚拟机
2. 虚拟机--->虚拟机　
3. 模板转换成虚拟机
4. 模板部署虚拟机
5. 使用模板导入虚拟机

虚拟机管理

虚拟机文件　一般至少两个文件.一个是虚拟机配置文件*.xml，一个是虚拟机磁盘文件*.img

在使用virt-install生成虚拟机时会生成一个默认xml格式的配置文件在/etc/libvirt/qemu目录下，使用virsh edit编辑虚拟机配置文件

虚拟机磁盘文件主要有raw 和qcow2格式

*.img磁盘文件是在FusionCompute中的文件后缀

虚拟机调整　调整CPU、内存、绑定/解绑磁盘、添加/删除网卡、挂载/卸载光驱、修改启动方式、绑定/解绑USB设备

虚拟机回收

- 安全删除　通过覆盖性擦写对磁盘空间进行删除，避免数据恢复，安全性性高，但删除速度慢，且删除时会占用系统资源
- 普通删除　破坏磁盘文件系统对磁盘空间进行删除，删除速度块，但是存在数据恢复可能，安全性差

通过删除不再使用的虚拟机，系统回收虚拟机占用的资源，删除虚拟机后，系统会自动将该虚拟机的所有虚拟机快照删除，同时解绑定与该虚拟机绑定的GPU资源组

存储类型为NAS的数据存储上的磁盘仅支持普通删除。

模板管理

- 虚拟机制作模板
- 模板或虚拟机导出为模板
- 导入模板
- 删除模板

快照管理
1. 创建快照　为虚拟机创建快照可以保存虚拟机配置和磁盘数据，用于虚拟机还原和恢复；如果创建内存快照，可以恢复虚拟机内存情况
2. 回滚快照　在虚拟机故障需要还原数据时，使用虚拟机已有快照，将虚拟机数据恢复到创建该快照的时刻
3. 删除快照　删除不再使用，过期的快照

tools管理

tools 是虚拟机的驱动程序，虚拟机安装完成后，安装tools以便提高虚拟机的I/O处理功能，实现虚拟机的硬件监控和其它高级功能，某些特性必须在有tools才能使用。　

Tools管理

当虚拟机出现失误，导致tools功能异常时，需要卸载tools重装;

- 为虚拟机提供高性能的磁盘I/O和网络I/O功能
- 为虚拟机提供硬件监控功能　获取指定网卡IP信息、获取个虚拟机内部CPU利用率、内存利用率、获取各磁盘/分区空间使用率信息
- 为虚拟机提供高级功能　迁移、安全关闭、安全重启、休眠、在线调整CPU规格、创建快照、蓝屏检测、主机时钟同步、网卡高级特性、自动升级驱动如tools驱动

虚拟机防病毒

FusionCompute联合防病毒厂商为用户提供虚拟化防病毒功能。华为提供虚拟化防病毒接口(API)，防病毒厂商基于该接口进行开发，集成其杀毒引擎、病毒库等，最终为用户提供虚拟化平台防病毒能力，使用该功能时，只需在主机上部署一台安全服务虚拟机并运行在该主机上的其它虚拟机安装防病毒驱动，即可为安全用户虚拟机提供病毒查杀，病毒实时监控等服务

防病毒管理中心　--->主机1 SVM1 GVM GVM 