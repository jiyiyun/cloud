目录
1. 背景
2. 原理
3. 应用场景
4. 配置举例

传统技术存在的问题

M-LAG主要应用场景是“双归接入”，即用户侧设备双规接入到两台接入设备上，这个场景下传统的技术主要有堆叠、smart-link等技术，但这些技术都有缺点

> 堆叠两台(或多台)使用一个控制面，单点故障可能会影响到整个系统，在升级时候尤为突出，因此很多用户不放心在汇聚、核心等稳定性要求比较高的地方使用堆叠

>SmartLink等技术使用的是主备方式接入，对于同一个VLAN，同时只有一个链路是转发的，链路利用率不高

为了解决传统技术这些问题，出现了双归接入的方式及M-LAG

M-LAG简介

M-LAG全称Multi-Chassis Link Aggregation即跨设备链路聚合。就是将不同设备上的不同端口组成一个LAG，达到跟普通LAG一样的功能
```txt
SW---------------SW     SW
       M-LAG            ||
                        ||
       LAG              SW
```
转发面 因为接入侧的设备是通过LAG接入的，流量会基于流，在LAG上负载分担到两台设备

控制面 组成M-LAG的两台设备是相互独立的，通过M-LAG协议进行交互。一台设备故障只会影响自己，不会影响另外一台设备

优势 1. 更高的可靠性 把链路可靠性从单板级提高到了设备级；2. 简化组网及配置 可以将M-LAG理解为一种横向虚拟化技术，将双归接入的两台设备在逻辑上虚拟成一台设备。M-LAG提供了一个没有环的二层拓扑同时实现冗余备份，不再需要繁琐的生成树协议配置，极大的简化了组网及配置；3. 独立升级 两台设备可以分别进行升级，保证有一台设备正常工作即可，对正在进行的业务几乎没有影响

基本概念

用户侧设备switch(可以是交换机或者主机)通过M-LAG机制与另外两台设备(switchA和switchB)进行跨设备链路聚合，组成一个双活系统。这样可以实现switchA 和switchB共同进行流量转发，保证网络的可靠性
```txt
            network
 
  SwitchA -----peer-link----- SwitchB
      |                          |     M-LAG成员接口
      |__________Switch__________|
                   ||
双活系统      Server1 Server2
```
- M-LAG主设备：部署M-LAG且状态为主的设备
- M-LAG备设备：部署M-LAG且状态为备的设备(正常情况下，主备设备同时进行业务流量转发)
- peer-link链路： peer-link链路是一条直连链路且必须做链路聚合，用于交换协商报文及传输部分流量。为了增加peer-link链路的可靠性，推荐采用多条链路做链路聚合
- peer-link接口：peer-link链路两端直连的接口均为peer-link接口
- 双主检测链路：双主检测是一条三层互通链路，用于M-LAG主备设备间按照1秒周期发送双主检测报文，用于peer-link链路故障时进行双主检测。需要注意的是：keepalive链路和peer-link是不同的两条链路，其作用
- M-LAG成员接口：