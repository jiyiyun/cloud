克隆技术分为完整克隆和链接克隆两种

目录
1. 链接克隆桌面技术原理
2. 链接克隆桌面解决方案

完整克隆方式中每一个桌面保持着独立性；而链接克隆桌面带来的是更方便的统一管理和更高的资源利用率。目前链接克隆已经是主流的桌面虚拟化方式。

完整克隆方式下，克隆虚拟机和源虚拟机是两个完全独立的实体，源虚拟机的修改乃至删除不会影响到克隆虚拟机的运行，但是缺点是不同虚拟机仍要各自占用完全独立的磁盘空间

与之相对应的是链接克隆方式，克隆虚拟机必须在源虚拟机存在的情况下才能运行，但是优点是多个克隆虚拟机之间公共部分(共同来自源虚拟机的部分)可以共用一份磁盘空间。

链接克隆的价值

基于链接克隆，能帮助客户提升效率、节约成本  秒级创建，缩短了发放时间，提高了虚拟机发放效率；节省大量存储空间，节约了企业IT成本；提高维护管理效率，可以方便的对链接克隆虚拟机统一进行打补丁系统更新等操作，节约后期维护成本。

```txt
         虚拟机
           |
           |
           |
母镜像    差分盘 标识盘
```
技术特点
- 相同OS多个客户虚拟机共享一个母镜像，母镜像可统一升级、维护
- 每个客户虚拟机保存虚拟化镜像差异化部分
- 可以实现关机自动还原
- 降低存储成本60%

适用场景 任务型桌面，或者只有个性化数据，没有个性化程序的场景(个性化程序会在母镜像更新后丢失)。

链接克隆的优势
- 管理员可以统一对链接克隆虚拟机进行系统升级、系统补丁、安装软件
- 共用系统母盘，创建虚拟桌面减少系统盘的复制过程
- 链接克隆的差分盘，保存用户工作的临时系统数据，只是把虚拟机关闭，差分盘就可以自动清除
- 通过与Active Directory配合，可以满足保存用户的个性化配置及个性化数据要求

只需通过把源链接克隆模版克隆为虚拟机，再启动该虚拟机，进行相关系统更新后，再把此虚拟机转为模版，使用“更新虚拟机组件”功能，即可完成系统母卷的更新；对IT系统运维和安全带来极大的便利

使用链接克隆桌面的用户，如果有保存个性化配置及个性化数据的要求，则可以通过在Active Directory上为这些用户规划配置Profile重定向或者文件夹重定向的方式来满足，其重定向保存的位置，可以是远程文件服务器目录、或网盘、或链接克隆桌面本身带的数据盘。其中，保存在远程服务器目录、或网盘中的个性化配置及个性化数据具有漫游能力，能随用户登录漫游到对应的桌面中。

链接克隆原理
```txt
                     VM 母卷
                   0 1 0 1 0 1
        VM1差分卷      ......     VMn差分卷
     1 0 0 0 0 0 0    ......   0 0 0 0 0 0 0
             |                        |
VM1链接克隆卷 |                        | VMn 链接克隆卷
             v                        v
    1 0 1 0 1 0 1 0 1  ......  0 1 0 1 0 1 0
```
链接克隆是一种通过将链接克隆母卷和链接克隆差分卷映射为一个链接克隆卷。提供给虚拟机使用的技术；其中链接母卷为只读卷，多个链接克隆虚拟机共用一份；链接克隆差分卷是读写卷，其存储是精简配置的，每个链接克隆虚拟机一份保存了每个虚拟机差异化的数据；链接克隆技术具有创建速度快、占用存储空间小的优点，非常适合同质化用户、桌面高度标准化场景。

链接克隆iCache加速
```txt
                  Desktop       Desktop
                  1| |          | |
内存                   iCache
                  2|1|         | |
共享/本地存储         | 差分卷  | 差分卷
                ---v------------------
                   母卷
```
链接克隆iCache加速是基于链接克隆中针对多个链接克隆虚拟机共用一份链接克隆母卷这一特点，提供的链接克隆虚拟机性能加速技术；它通过把链接克隆母卷的热点数据缓存到主机有限的内存cache中来达到虚拟机运行加速的目的。

链接克隆虚拟机运行时需要读取存储上的链接克隆母卷数据前，会先到内存cache中读取，如果在内存cache中读取不到，才会到存储上读取数据；并且iCache会根据需要动态的把热点数据放入到主机内存cache中，来提升内存cache命中率

根据iCache的加速原理可知链接克隆虚拟机在运行过程中会减少对母卷存储本身的读IOPS压力，这不但缓解了批量链接克隆虚拟机启动时对存储压力大的启动风暴问题，而且提升了链接克隆虚拟机的启动速度，并且链接克隆虚拟机启动的性能也有改善。

模板、母卷与差分卷
```txt
 =模版30G
  |           数据存储1                   数据存储2
  = A母卷30G         =B母卷30G                =C母卷30G
  |                     |                       |
  = 差分卷3~30G          |                       |
  = VM1差分卷 ...... VM129差分卷               VM130差分卷
  |                     |                       |
Desktop1              Desktop129              Desktop
```
如上图，如果一个链接克隆模版为30G，在数据存储1上创建链接克隆VM时，会自动复制模版，在数据存储1上产生一个A母卷，大小也为30G，再以A母卷为基础，自动快照为每个VM创建差分卷；当A母卷上创建的差分卷个数达到128个时(规格限制一个母卷最多产生128个差分卷，防止每个母卷所在存储块区域所在VMs都运行的情况下I/O压力过高)，系统会自动在该数据存储1上产生一个新的B母卷，为其它链接克隆VM创建新的差分卷，以此类推

系统为每个VM创建的差分卷，是精简配置的存储(瘦分配)，最初大小接近于0，但差分卷最终要保存数据，每个差分卷最小存储预估大小不能小于3G，最大不会超过模版大小，一般根据链接克隆的使用场景以及还原频率，平均预估5G、10G、12G不等。

母卷、差分卷是必须在同一块数据存储上；模板与母卷、差分卷可以在不同数据存储上；只能在支持精简配置(瘦分配)的数据存储上，才能创建链接克隆VM

链接克隆及iCache的读写原理对比
```txt


```