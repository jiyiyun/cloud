目录
1. 存储模型
2. 虚拟化存储连接
3. 存储虚拟化原理
4. 存储虚拟化特性
5. 存储虚拟化常用功能

- 存储资源 物理存储设备，如IPSAN、Advanced SAN、NAS等
- 存储设备 存储资源中的管理单元，类LUN、Advanced SAN存储池、NAS共享目录等
- 数据存储 虚拟化平台可管理、操作的存储逻辑单元

一个存储资源可以有多个存储设备；一个数据存储和一个存储设备对应；数据存储承载了具体的虚拟机业务，如创建磁盘等
```txt
逻辑对象                  物理实体
卷  卷
数据存储  数据存储
  ^        ^
  |        |
存储设备  存储设备 <------> 存储池        LUN   共享目录 本地磁盘
  ^        ^               ^            ^      ^
  |        |               |            |      |
  存 储 资 源 <---------->FusionStorage SAN    NAS
```
存储资源类型 FCSAN 、IPSAN 、NAS 、Advanced SAN 、FusionStorage

数据存储 在存储设备上创建的逻辑管理单元：数据存储可以关联到多个主机，一个主机可以使用多个数据存储

数据存储的使用 存储设备只有被添加为数据存储才能被使用；数据存储可用于存放虚拟机磁盘、快照文件；数据存储的大小依赖于存储设备的大小

FCSAN存储场景
```txt
虚拟机磁盘文件直接存放在数据存储中  FusionCompute中使用存储设备创建数据存储
                       DataStore1
  FusionConpute                      FusionCompute
  Server HBA卡                           Server HBA卡
服务器通过HBA卡连接到SAN网络             SAN网络，光纤连接，使用光纤交换机
存储设备:LUN,常见为共享存储方式，LUN挂载给多台主机
```

iSCSI存储场景
```txt
虚拟机磁盘文件直接存放在数据存储中  FusionCompute中使用存储设备创建数据存储
                       DataStore1
  FusionConpute                      FusionCompute
  Server                             Server
服务器通过网卡连接到LAN网络              LAN网络，TCP/IP连接，以太网交换机
存储设备:LUN,常见为共享存储方式，LUN挂载给多台主机
```

NAS存储场景
```txt
虚拟机磁盘文件直接存放在数据存储中  FusionCompute中使用存储设备创建数据存储
                       DataStore1
  FusionConpute                      FusionCompute
  Server                             Server
服务器通过网卡连接到LAN网络              LAN网络，TCP/IP连接，以太网交换机
存储设备:共享文件夹，常见为共享存储方式，共享文件夹映射给多台主机
```
虚拟化的存储栈 将不同存储设备格式化，屏蔽存储设备的能力、接口协议等差异性，将各种存储资源转化为统一管理的数据存储管理，可以用来存储虚拟机磁盘、虚拟机配置信息、快照等信息，使用户对存储的管理更加同质化

FC Fibre Channel 网状通道

文件系统 
---

文件系统作用在于提供文件操作接口，屏蔽存储设备的差异，为虚拟化卷文件提供存放空间

当前FusionCompute所使用的文件系统为VIMS 、EXT4 、NFS
```txt
-----------------------------------------------------------------
|    | 所需存储设备 | 是否创建文件系统 | 是否支持共享 | 是否支持延迟置零卷|
|VIMS| LUN        |     是         |   是       |     是         |
|EXT4| 本地磁盘    |     是         |   否       |     是          |
|NFS | 共享目录    |     是         |   是       |     否          |
-----------------------------------------------------------------
```
计算集群共享存储设备上的文件系统为 VIMS文件系统或NFS文件系统

VIMS(Virtual Image Manage System)

VIMS高性能集群文件系统，是Thin Provisioning、快照、存储迁移等高级特性的技术基础；兼容FC SAN IPSAN NAS 本地磁盘；支持固定空间磁盘、动态空间磁盘、差分磁盘等

应用场景 需要存储迁移、快照、链接、克隆等高级存储特性虚拟机

VIMS高性能集群文件系统，使虚拟化技术的应用超出了单个存储系统的限制，其设计、构建和优化针对虚拟服务器环境，可让多个虚拟机共同访问一个整合的集群式存储池，从而提高了资源利用率。

虚拟磁盘文件

VHD镜像格式是FusionCompute实现精简卷、快照等功能的基本载体，实现了FusionCompute虚拟机镜像数据的基本存储功能；虚拟机的一个虚拟磁盘对应一个VHD文件

虚拟磁盘文件格式 固态磁盘文件 动态磁盘文件 差分磁盘文件

一个虚拟机在虚拟化计算节点文件系统上表现为一个或多个虚拟磁盘文件，也就是说，一个虚拟机磁盘体现为一个或多个虚拟磁盘文件

