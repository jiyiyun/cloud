目录
1. HyperSnap(LUN)
2. HyperSnap(FS)
3. HyperReplication
4. HyperClone

LUN快照概述

- 定义 快照是指源数据在某个时间点的一致性数据副本。快照生成后可被主机读取，可以作为某个时间点的数据备份
- 快照主要特点 1. 瞬间生成 存储系统可以在几秒内生成一个快照，获取源数据的一致性副本。 2. 占用存储空间小 生成的快照数据并非完整的物理数据拷贝，不会占用大量存储空间，即使数据量大也占用很少存储空间

相关概念

|中文|英文|定义/描述|
|:---:|:---|:---|
|源卷|source volume|需要进行快照操作的源数据所在卷，对用户表现为LUN，源卷包括meta volume和data volume -meta volume记录源数据在源卷中存在的位置 -data volume 记录源卷中存放的数据|
|COW数据空间|COW data space|快照生成并激活后，发生写前拷贝时，从存储池分配的存储空间，用于保存源卷在激活时间点的数据。同一个源卷对应所有快照卷共享一个COW数据空间|
|快照卷|snapshot volume|对源卷创建快照后，逻辑上生成数据副本，对用户而言，表现为快照LUN|
|快照回滚|snapshot rollback|将快照LUN的数据复制给源LUN，从而使源LUN的数据恢复成生成快照LUN时刻的数据|
|映射表|mappingtable|映射表用于记录源卷数据和快照卷数据在某个时刻点的改变情况以及改变后数据存储位置，分共享部分和非共享部分|
|未激活状态|Inactive|快照的一种状态，在这种状态下快照不可用，需要进行激活操作后可用|

COW(Copy over Write) 写前拷贝，即在主机写快照源LUN之前，先将源LUN的保护数据拷贝到其它地方，拷贝完成后，主机IO才继续写源LUN
COW数据空间 
共享映射表 激活快照后，快照源LUN上发生的变更统一存放在共享映射表上，一个源LUN上的所有快照共同使用该映射表
独享映射表 激活快照后，快照卷上写入的数据都记录在独享映射表上，每个快照都有自己一张独享映射表

HyperSnap(FS)

相关概念

|缩略语|英文全名|中文解释|
|:---:|:---|:---|
|ROW|Redirect On Write|写时重定向，即数据修改写时，不覆盖磁盘上的旧数据，而是新分配磁盘空间将数据写入|
|COW|Copy On Write|写时拷贝 即数据修改写入时，将磁盘上的旧数据拷贝到新位置，而将新数据直接写入旧数据原有的磁盘位置|

数据更新
- 快照刚创建时，快照数据和源文件系统数据是相同的，在磁盘上引用的是同一份数据
- 修改文件数据后，根据ROW机制，新数据会写入新的磁盘空间，并检查旧数据是否受快照保护，若受快照保护，则不释放旧数据空间；否则释放旧数据磁盘空间
- 随着文件系统的更新 被修改过的快照数据会逐步变成快照独自引用的数据，随之快照的占用空间也会逐步增长


